<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exercise Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <style>
      /* ... existing styles ... */
      
      /* AI Avatar Styles */
      #exercise-ai-avatar {
        position: relative;
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        transition: all 0.5s ease;
      }
      
      .avatar-shape {
        position: absolute;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        transition: all 0.8s ease;
      }
      
      .avatar-shape:nth-child(1) {
        width: 60%;
        height: 60%;
        top: 20%;
        left: 20%;
      }
      
      .avatar-shape:nth-child(2) {
        width: 40%;
        height: 40%;
        top: 30%;
        left: 30%;
      }
      
      .avatar-shape:nth-child(3) {
        width: 25%;
        height: 25%;
        top: 37.5%;
        left: 37.5%;
      }
      
      @keyframes morph1 {
        0%, 100% { border-radius: 50%; transform: scale(1); }
        25% { border-radius: 25% 75% 70% 30% / 30% 30% 70% 70%; transform: scale(0.9) rotate(10deg); }
        50% { border-radius: 70% 30% 30% 70% / 70% 30% 70% 30%; transform: scale(1.1) rotate(-10deg); }
        75% { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; transform: scale(0.9) rotate(10deg); }
      }
      
      @keyframes morph2 {
        0%, 100% { border-radius: 50%; transform: scale(1); }
        25% { border-radius: 70% 30% 50% 50% / 30% 30% 70% 70%; transform: scale(1.1) rotate(-5deg); }
        50% { border-radius: 40% 60% 30% 70% / 60% 40% 60% 40%; transform: scale(0.9) rotate(5deg); }
        75% { border-radius: 60% 40% 60% 30% / 30% 60% 40% 70%; transform: scale(1.1) rotate(-5deg); }
      }
      
      @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 3px 1px rgba(59, 130, 246, 0.4); }
        50% { box-shadow: 0 0 8px 3px rgba(59, 130, 246, 0.7); }
      }
      
      .animate-avatar .avatar-shape:nth-child(1) {
        animation: morph1 8s ease infinite, pulse-glow 3s ease infinite;
      }
      
      .animate-avatar .avatar-shape:nth-child(2) {
        animation: morph2 12s ease infinite;
      }
      
      .animate-avatar .avatar-shape:nth-child(3) {
        animation: pulse-glow 2s ease infinite;
      }
    </style>
  </head>
  <body class="bg-gray-900 min-h-screen text-gray-200">
    <!-- Navigation bar -->
    <nav class="bg-gray-800 border-b border-gray-700">
      <div class="container mx-auto px-4">
        <div class="flex justify-between items-center h-16">
          <div class="flex-shrink-0 font-bold text-xl text-blue-400">
            AptiFit
          </div>
          <div class="flex space-x-2 md:space-x-4 items-center">
            <a href="{% url 'index' %}" class="px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white transition duration-300">
              Home
            </a>
            
            {% if user.userprofile.height and user.userprofile.weight and user.userprofile.sex and user.userprofile.age %}
            <a href="{% url 'diet_tracker' %}" class="px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white transition duration-300">
              Diet Tracker
            </a>
            <a href="{% url 'exercise_tracker' %}" class="px-3 py-2 rounded-md text-sm font-medium bg-gray-700 text-white">
              Exercise Tracker
            </a>
            <a href="{% url 'chatbot' %}" class="px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white transition duration-300">
              Chatbot
            </a>
            {% else %}
            <span class="px-3 py-2 rounded-md text-sm font-medium text-gray-500 cursor-not-allowed" title="Complete your profile to unlock this feature">
              <i class="fas fa-lock mr-1"></i> Diet Tracker
            </span>
            <span class="px-3 py-2 rounded-md text-sm font-medium text-gray-500 cursor-not-allowed" title="Complete your profile to unlock this feature">
              <i class="fas fa-lock mr-1"></i> Exercise Tracker
            </span>
            <span class="px-3 py-2 rounded-md text-sm font-medium text-gray-500 cursor-not-allowed" title="Complete your profile to unlock this feature">
              <i class="fas fa-lock mr-1"></i> Chatbot
            </span>
            {% endif %}
            
            <a href="{% url 'profile' %}" class="px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white transition duration-300">
              Profile: {{ user.username }}
            </a>
            <a href="{% url 'logout' %}" class="px-3 py-2 rounded-md text-sm font-medium text-red-400 hover:bg-red-900 hover:text-red-200 transition duration-300">
              Logout
            </a>
          </div>
        </div>
      </div>
    </nav>
    
    <div class="container mx-auto px-4 py-8">
      <!-- Page Header with Hero Image -->
      <div class="relative overflow-hidden rounded-xl mb-8">
        <img src="https://hips.hearstapps.com/hmg-prod/images/gym-workout-weight-training-bodybuilding-muscular-royalty-free-image-1703160802.jpg?crop=0.670xw:1.00xh;0.216xw,0&resize=1200:*" alt="Gym workout" class="w-full h-64 object-cover object-center rounded-xl">
        <div class="absolute inset-0 bg-gradient-to-r from-gray-900/80 to-gray-900/40 flex items-center">
          <div class="px-6 py-4">
            <h1 class="text-4xl font-bold text-white mb-2">Exercise Tracker</h1>
            <p class="text-gray-200 text-lg">Get personalized gym exercise recommendations based on your fitness level</p>
          </div>
        </div>
      </div>
      
      <!-- User Fitness Stats Quick View -->
      <div class="bg-gray-800 rounded-lg p-4 mb-8 border border-gray-700">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div class="text-center p-3 bg-gray-700 rounded-lg">
            <h3 class="text-sm font-medium text-gray-400">BMI</h3>
            <p class="text-xl font-bold">{{ user.userprofile.bmi|default:"--" }}</p>
            <p class="text-sm text-gray-400">{{ user.userprofile.bmi_category|default:"Complete profile" }}</p>
          </div>
          <div class="text-center p-3 bg-gray-700 rounded-lg">
            <h3 class="text-sm font-medium text-gray-400">Body Fat</h3>
            <p class="text-xl font-bold">{{ user.userprofile.body_fat|default:"--" }}%</p>
            <p class="text-sm text-gray-400">{{ user.userprofile.body_fat_category|default:"Complete profile" }}</p>
          </div>
          <div class="text-center p-3 bg-gray-700 rounded-lg">
            <h3 class="text-sm font-medium text-gray-400">Weight</h3>
            <p class="text-xl font-bold">{{ user.userprofile.weight|default:"--" }} kg</p>
          </div>
          <div class="text-center p-3 bg-gray-700 rounded-lg">
            <h3 class="text-sm font-medium text-gray-400">Age</h3>
            <p class="text-xl font-bold">{{ user.userprofile.age|default:"--" }}</p>
          </div>
        </div>
      </div>
      
      <!-- Dashboard Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        
        <!-- Exercise Plan Section -->
        <div class="lg:col-span-2">
          <!-- Fitness Level Selection Form -->
          {% if not exercise_plan %}
          <div class="bg-gray-800 rounded-lg shadow-xl border border-gray-700 overflow-hidden mb-8">
            <div class="bg-blue-800 text-white p-4">
              <h2 class="text-xl font-bold">Select Your Fitness Level</h2>
            </div>
            <div class="p-6">
              <div class="mb-6">
                <img src="https://explosivewhey.com/cdn/shop/articles/best-workout-routine-for-gym-beginners-135325.png?v=1738755379&width=2048" alt="Workout routine chart" class="w-full h-auto rounded-lg shadow-lg mb-6">
              </div>
              <form method="post" action="{% url 'exercise_tracker' %}">
                {% csrf_token %}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <!-- Beginner Level Card -->
                  <label class="cursor-pointer">
                    <input type="radio" name="fitness_level" value="beginner" class="hidden peer" required>
                    <div class="bg-gray-700 p-5 rounded-lg border-2 border-gray-600 hover:border-blue-500 peer-checked:border-blue-500 peer-checked:bg-blue-900/30 transition duration-300">
                      <div class="text-center mb-4">
                        <i class="fas fa-walking text-4xl text-blue-400 mb-2"></i>
                        <h3 class="text-xl font-bold">Beginner</h3>
                      </div>
                      <ul class="space-y-2 text-sm text-gray-300">
                        <li class="flex items-start">
                          <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                          <span>New to exercise or returning after long break</span>
                        </li>
                        <li class="flex items-start">
                          <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                          <span>Focus on proper form and technique</span>
                        </li>
                        <li class="flex items-start">
                          <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                          <span>Build foundational strength and endurance</span>
                        </li>
                      </ul>
                    </div>
                  </label>
                  
                  <!-- Intermediate Level Card -->
                  <label class="cursor-pointer">
                    <input type="radio" name="fitness_level" value="intermediate" class="hidden peer">
                    <div class="bg-gray-700 p-5 rounded-lg border-2 border-gray-600 hover:border-blue-500 peer-checked:border-blue-500 peer-checked:bg-blue-900/30 transition duration-300">
                      <div class="text-center mb-4">
                        <i class="fas fa-running text-4xl text-blue-400 mb-2"></i>
                        <h3 class="text-xl font-bold">Intermediate</h3>
                      </div>
                      <ul class="space-y-2 text-sm text-gray-300">
                        <li class="flex items-start">
                          <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                          <span>Consistent training for at least 6 months</span>
                        </li>
                        <li class="flex items-start">
                          <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                          <span>Comfortable with basic exercises</span>
                        </li>
                        <li class="flex items-start">
                          <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                          <span>Ready for more complex movements</span>
                        </li>
                      </ul>
                    </div>
                  </label>
                  
                  <!-- Advanced Level Card -->
                  <label class="cursor-pointer">
                    <input type="radio" name="fitness_level" value="advanced" class="hidden peer">
                    <div class="bg-gray-700 p-5 rounded-lg border-2 border-gray-600 hover:border-blue-500 peer-checked:border-blue-500 peer-checked:bg-blue-900/30 transition duration-300">
                      <div class="text-center mb-4">
                        <i class="fas fa-dumbbell text-4xl text-blue-400 mb-2"></i>
                        <h3 class="text-xl font-bold">Advanced</h3>
                      </div>
                      <ul class="space-y-2 text-sm text-gray-300">
                        <li class="flex items-start">
                          <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                          <span>Several years of consistent training</span>
                        </li>
                        <li class="flex items-start">
                          <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                          <span>Strong foundational strength and technique</span>
                        </li>
                        <li class="flex items-start">
                          <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                          <span>Ready for high-intensity, challenging workouts</span>
                        </li>
                      </ul>
                    </div>
                  </label>
                </div>
                
                <div class="mt-8 text-center">
                  <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition duration-300">
                    <i class="fas fa-dumbbell mr-2"></i>Generate My Exercise Plan
                  </button>
                  <p class="text-gray-400 mt-2 text-sm">We'll use your profile data to create a personalized plan</p>
                </div>
              </form>
            </div>
          </div>
          {% endif %}
          
          <!-- Exercise Plan Results -->
          {% if exercise_plan %}
          <div class="bg-gray-800 rounded-lg shadow-xl border border-gray-700 overflow-hidden">
            <div class="bg-blue-800 text-white p-4 flex justify-between items-center">
              <h2 class="text-xl font-bold">Your {{ fitness_level|title }} Exercise Plan</h2>
              <a href="{% url 'exercise_tracker' %}?new_plan=true" class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded transition duration-300">
                <i class="fas fa-sync-alt mr-1"></i> Create New Plan
              </a>
            </div>
            
            <!-- AI Avatar for Exercise Description -->
            <div id="exercise-ai-avatar-container" class="relative bg-gradient-to-r from-gray-900 to-gray-800 p-4 border-b border-gray-700">
              <div class="flex items-center">
                <div id="exercise-ai-avatar" class="w-16 h-16 rounded-full bg-blue-600 flex-shrink-0 mr-4 flex items-center justify-center overflow-hidden relative">
                  <div class="avatar-shape"></div>
                  <div class="avatar-shape"></div>
                  <div class="avatar-shape"></div>
                </div>
                <div class="flex-1">
                  <div class="bg-gray-700 rounded-lg p-3 relative">
                    <div class="absolute left-0 top-1/2 transform -translate-x-2 -translate-y-1/2 w-0 h-0 border-t-8 border-r-8 border-b-8 border-transparent border-r-gray-700"></div>
                    <p id="exercise-ai-message" class="text-gray-300">Click "Ask AI" button to analyze your exercise plan.</p>
                  </div>
                  <div class="text-xs text-gray-500 mt-1 flex items-center">
                    <i class="fas fa-robot mr-1"></i> AptiFit Trainer
                    <div class="ml-auto flex items-center">
                      <button id="ask-exercise-ai-btn" class="text-blue-400 hover:text-blue-300 mr-3">
                        <i class="fas fa-robot mr-1"></i> Ask AI
                      </button>
                      <button id="exercise-play-again-btn" class="text-blue-400 hover:text-blue-300 hidden mr-3">
                        <i class="fas fa-play-circle mr-1"></i> Play Again
                      </button>
                      <button id="exercise-toggle-sound-btn" class="text-blue-400 hover:text-blue-300">
                        <i class="fas fa-volume-up"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="p-6">
              <!-- Plan date indicator -->
              {% if last_updated %}
              <div class="text-sm text-gray-400 mb-4">
                <span><i class="fas fa-calendar-alt mr-1"></i> Plan created: {{ created_at|date:"F j, Y" }}</span>
                {% if last_updated != created_at %}
                <span class="ml-4"><i class="fas fa-edit mr-1"></i> Last updated: {{ last_updated|date:"F j, Y" }}</span>
                {% endif %}
              </div>
              {% endif %}
              
              <!-- Exercise visual guide -->
              <div class="mb-6">
                <div class="relative">
                  <img src="https://explosivewhey.com/cdn/shop/articles/best-workout-routine-for-gym-beginners-135325.png?v=1738755379&width=2048" alt="Exercise guide" class="w-full h-auto rounded-lg opacity-85">
                  <div class="absolute top-4 right-4 bg-blue-600 text-white text-xs px-3 py-1 rounded-full">
                    Exercise Guide
                  </div>
                </div>
              </div>
              
              <!-- Days tabs -->
              <div class="mb-6">
                <div class="flex overflow-x-auto bg-gray-800 rounded-t-lg border border-gray-700">
                  {% for day_plan in exercise_plan.schedule %}
                  <button 
                    class="day-tab px-4 py-3 text-sm font-medium transition duration-300 {% if forloop.first %}active-tab bg-blue-900 text-white{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %}"
                    data-day="{{ day_plan.day|lower }}"
                  >
                    {{ day_plan.day }}
                    <span class="block text-xs mt-1 font-normal">{{ day_plan.focus }}</span>
                  </button>
                  {% endfor %}
                </div>
              </div>
              
              <!-- Day content -->
              {% for day_plan in exercise_plan.schedule %}
              <div 
                id="day-{{ day_plan.day|lower }}" 
                class="day-content bg-gray-800 rounded-lg border border-gray-700 p-6 mb-6 {% if not forloop.first %}hidden{% endif %}"
              >
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-xl font-bold text-white">{{ day_plan.day }}: {{ day_plan.focus }}</h3>
                  <span class="bg-blue-900 text-white text-xs px-3 py-1 rounded-full">{{ day_plan.duration }}</span>
                </div>
                
                <!-- Warm-up -->
                <div class="mb-6">
                  <h4 class="text-blue-400 font-semibold mb-2">Warm-up</h4>
                  <div class="bg-gray-700 p-4 rounded-lg border border-gray-600">
                    <p>{{ day_plan.warmup }}</p>
                  </div>
                </div>
                
                <!-- Exercises -->
                <div class="mb-6">
                  <h4 class="text-blue-400 font-semibold mb-2">Exercises</h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for exercise in day_plan.exercises %}
                    <div class="bg-gray-700 p-4 rounded-lg border border-gray-600">
                      <h5 class="font-bold mb-2">{{ exercise.name }}</h5>
                      <div class="grid grid-cols-3 gap-2 mb-2 text-sm">
                        <div class="bg-gray-800 p-2 rounded text-center">
                          <span class="block text-gray-400 text-xs">Sets</span>
                          <span>{{ exercise.sets }}</span>
                        </div>
                        <div class="bg-gray-800 p-2 rounded text-center">
                          <span class="block text-gray-400 text-xs">Reps</span>
                          <span>{{ exercise.reps }}</span>
                        </div>
                        <div class="bg-gray-800 p-2 rounded text-center">
                          <span class="block text-gray-400 text-xs">Rest</span>
                          <span>{{ exercise.rest }}</span>
                        </div>
                      </div>
                      {% if exercise.notes %}
                      <p class="text-sm text-gray-300 mt-2"><span class="text-blue-400">Note:</span> {{ exercise.notes }}</p>
                      {% endif %}
                    </div>
                    {% endfor %}
                  </div>
                </div>
                
                <!-- Cool-down -->
                <div>
                  <h4 class="text-blue-400 font-semibold mb-2">Cool-down</h4>
                  <div class="bg-gray-700 p-4 rounded-lg border border-gray-600">
                    <p>{{ day_plan.cooldown }}</p>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
        
        <!-- Stats and Events Section -->
        <div class="lg:col-span-1">
          <div class="grid grid-cols-1 gap-6">
            
            <!-- Weekly Activity Stats -->
            <div class="bg-gray-800 rounded-lg shadow-xl border border-gray-700 overflow-hidden">
              <div class="bg-blue-800 text-white p-4">
                <h2 class="text-xl font-bold">Weekly Activity</h2>
              </div>
              <div class="p-5">
                <div class="flex space-x-2 mb-3">
                  {% for day in "MTWTFSS" %}
                    <div class="flex-1">
                      <div class="text-xs text-center mb-1 text-gray-400">{{ day }}</div>
                      <div class="{% if forloop.counter < 5 %}bg-green-500{% else %}bg-gray-600{% endif %} h-16 rounded-md relative">
                        {% if forloop.counter < 5 %}
                          <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white">
                            {{ forloop.counter|add:"30" }}min
                          </div>
                        {% endif %}
                      </div>
                    </div>
                  {% endfor %}
                </div>
                <p class="text-sm text-gray-300 mt-2">You completed 4 of 7 planned workout days</p>
              </div>
            </div>
            
            <!-- Progress visual -->
            <div class="bg-gray-800 rounded-lg shadow-xl border border-gray-700 overflow-hidden">
              <img src="https://hips.hearstapps.com/hmg-prod/images/gym-workout-weight-training-bodybuilding-muscular-royalty-free-image-1703160802.jpg?crop=0.670xw:1.00xh;0.216xw,0&resize=1200:*" alt="Fitness progress" class="w-full h-48 object-cover">
            </div>
            
            <!-- Upcoming Events & Challenges -->
            <div class="bg-gray-800 rounded-lg shadow-xl border border-gray-700 overflow-hidden">
              <div class="bg-purple-800 text-white p-4">
                <h2 class="text-xl font-bold">Upcoming Events & Challenges</h2>
              </div>
              <div class="p-5 space-y-4">
                <!-- Event 1 -->
                <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                  <div class="flex items-center mb-2">
                    <span class="bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded mr-2">NEW</span>
                    <h3 class="font-semibold text-white">30 Day Core Challenge</h3>
                  </div>
                  <p class="text-gray-300 text-sm mb-2">Build core strength with daily exercises</p>
                  <div class="flex justify-between items-center">
                    <span class="text-xs text-gray-400">Starts in 3 days</span>
                    <a href="#" class="bg-purple-600 hover:bg-purple-700 text-white text-xs px-3 py-1 rounded transition duration-300">Join</a>
                  </div>
                </div>
                
                <!-- Event 2 -->
                <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                  <div class="flex items-center mb-2">
                    <span class="bg-green-600 text-white text-xs font-bold px-2 py-1 rounded mr-2">COMMUNITY</span>
                    <h3 class="font-semibold text-white">Virtual 5K Run</h3>
                  </div>
                  <p class="text-gray-300 text-sm mb-2">Join fellow users for a virtual 5K run</p>
                  <div class="flex justify-between items-center">
                    <span class="text-xs text-gray-400">This weekend</span>
                    <a href="#" class="bg-green-600 hover:bg-green-700 text-white text-xs px-3 py-1 rounded transition duration-300">Sign Up</a>
                  </div>
                </div>
                
                <!-- View all link -->
                <div class="text-center mt-2">
                  <a href="#" class="text-purple-400 hover:text-purple-300 text-sm font-medium transition duration-300">
                    View all events <i class="fas fa-arrow-right ml-1"></i>
                  </a>
                </div>
              </div>
            </div>
            
            <!-- Goal Tracking -->
            <div class="bg-gray-800 rounded-lg shadow-xl border border-gray-700 overflow-hidden">
              <div class="bg-blue-800 text-white p-4">
                <h2 class="text-xl font-bold">Next Goal</h2>
              </div>
              <div class="p-5">
                <div class="bg-gray-700 p-3 rounded-lg mb-3">
                  <div class="flex items-center mb-2">
                    <svg class="w-4 h-4 text-yellow-400 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="text-sm font-medium text-white">Run 5K in under 30 minutes</span>
                  </div>
                  <div class="w-full bg-gray-600 rounded-full h-2.5 mb-1">
                    <div class="bg-yellow-400 h-2.5 rounded-full" style="width: 65%"></div>
                  </div>
                  <div class="flex justify-between text-xs">
                    <span class="text-gray-400">Current: 32:45</span>
                    <span class="text-gray-400">65% complete</span>
                  </div>
                </div>
                <a href="#" class="inline-block bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium px-4 py-2 rounded transition duration-300">
                  <i class="fas fa-flag mr-1"></i> Set New Goal
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Progress Overview Section -->
      <div class="mb-8">
        <div class="bg-gray-800 rounded-lg shadow-xl border border-gray-700 overflow-hidden">
          <div class="bg-gradient-to-r from-blue-800 to-purple-800 text-white p-4">
            <h2 class="text-xl font-bold">Your Progress Overview</h2>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <!-- Weekly Activity -->
              <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                <h3 class="font-semibold text-blue-400 mb-3">Weekly Activity</h3>
                <div class="flex space-x-2 mb-3">
                  {% for day in "MTWTFSS" %}
                    <div class="flex-1">
                      <div class="text-xs text-center mb-1 text-gray-400">{{ day }}</div>
                      <div class="{% if forloop.counter < 5 %}bg-green-500{% else %}bg-gray-600{% endif %} h-16 rounded-md relative">
                        {% if forloop.counter < 5 %}
                          <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white">
                            {{ forloop.counter|add:"30" }}min
                          </div>
                        {% endif %}
                      </div>
                    </div>
                  {% endfor %}
                </div>
                <p class="text-sm text-gray-300 mt-2">You completed 4 of 7 planned workout days</p>
              </div>
              
              <!-- Calorie Balance -->
              <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                <h3 class="font-semibold text-blue-400 mb-3">Calorie Balance (Today)</h3>
                <div class="space-y-3">
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span class="text-gray-300">Consumed</span>
                      <span class="text-white font-medium">1,820 kcal</span>
                    </div>
                    <div class="w-full bg-gray-600 rounded-full h-2.5">
                      <div class="bg-blue-500 h-2.5 rounded-full" style="width: 75%"></div>
                    </div>
                  </div>
                  <div>
                    <div class="flex justify-between text-sm mb-1">
                      <span class="text-gray-300">Burned</span>
                      <span class="text-white font-medium">320 kcal</span>
                    </div>
                    <div class="w-full bg-gray-600 rounded-full h-2.5">
                      <div class="bg-orange-500 h-2.5 rounded-full" style="width: 30%"></div>
                    </div>
                  </div>
                  <div class="pt-2 border-t border-gray-600 mt-2">
                    <div class="flex justify-between text-sm">
                      <span class="text-gray-300">Remaining</span>
                      <span class="text-green-400 font-medium">500 kcal</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Tips and Precautions -->
              <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                <h3 class="font-semibold text-blue-400 mb-3">Training Tips</h3>
                <ul class="space-y-2 text-sm text-gray-300">
                  {% for tip in exercise_plan.tips|slice:":3" %}
                  <li class="flex items-start">
                    <span class="text-blue-400 mr-2">•</span>
                    <span>{{ tip }}</span>
                  </li>
                  {% empty %}
                  <li class="flex items-start">
                    <span class="text-blue-400 mr-2">•</span>
                    <span>Start slow and gradually increase intensity</span>
                  </li>
                  <li class="flex items-start">
                    <span class="text-blue-400 mr-2">•</span>
                    <span>Stay hydrated throughout your workout</span>
                  </li>
                  <li class="flex items-start">
                    <span class="text-blue-400 mr-2">•</span>
                    <span>Focus on proper form over heavier weights</span>
                  </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tips and Precautions -->
      {% if exercise_plan %}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <!-- Tips -->
        <div class="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
          <div class="bg-blue-800 text-white p-4">
            <h3 class="text-lg font-bold">Training Tips</h3>
          </div>
          <div class="p-5">
            <ul class="space-y-3 text-gray-300">
              {% for tip in exercise_plan.tips %}
              <li class="flex items-start">
                <span class="text-blue-400 mr-2">•</span>
                <span>{{ tip }}</span>
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
        
        <!-- Precautions -->
        <div class="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
          <div class="bg-red-800 text-white p-4">
            <h3 class="text-lg font-bold">Important Precautions</h3>
          </div>
          <div class="p-5">
            <ul class="space-y-3 text-gray-300">
              {% for precaution in exercise_plan.precautions %}
              <li class="flex items-start">
                <span class="text-red-400 mr-2">•</span>
                <span>{{ precaution }}</span>
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
      {% endif %}
    </div>
    
    <!-- JavaScript for tab functionality -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Get all tabs and content
        const tabs = document.querySelectorAll('.day-tab');
        const contents = document.querySelectorAll('.day-content');
        
        // Add click event to each tab
        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            const day = tab.getAttribute('data-day');
            
            // Hide all content and remove active class from tabs
            contents.forEach(content => {
              content.classList.add('hidden');
            });
            tabs.forEach(t => {
              t.classList.remove('active-tab', 'bg-blue-900', 'text-white');
              t.classList.add('text-gray-300', 'hover:bg-gray-700', 'hover:text-white');
            });
            
            // Show selected content and add active class to clicked tab
            document.getElementById(`day-${day}`).classList.remove('hidden');
            tab.classList.add('active-tab', 'bg-blue-900', 'text-white');
            tab.classList.remove('text-gray-300', 'hover:bg-gray-700', 'hover:text-white');
            
            // Update the AI description when changing tabs
            getExerciseDetails(day);
          });
        });
        
        // AI Avatar Animation Styles - add these if not already present
        const avatarStyles = `
          @keyframes morph1 {
            0%, 100% { border-radius: 50%; transform: scale(1); }
            25% { border-radius: 25% 75% 70% 30% / 30% 30% 70% 70%; transform: scale(0.9) rotate(10deg); }
            50% { border-radius: 70% 30% 30% 70% / 70% 30% 70% 30%; transform: scale(1.1) rotate(-10deg); }
            75% { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; transform: scale(0.9) rotate(10deg); }
          }
          
          @keyframes morph2 {
            0%, 100% { border-radius: 50%; transform: scale(1); }
            25% { border-radius: 70% 30% 50% 50% / 30% 30% 70% 70%; transform: scale(1.1) rotate(-5deg); }
            50% { border-radius: 40% 60% 30% 70% / 60% 40% 60% 40%; transform: scale(0.9) rotate(5deg); }
            75% { border-radius: 60% 40% 60% 30% / 30% 60% 40% 70%; transform: scale(1.1) rotate(-5deg); }
          }
          
          @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 3px 1px rgba(59, 130, 246, 0.4); }
            50% { box-shadow: 0 0 8px 3px rgba(59, 130, 246, 0.7); }
          }
          
          .animate-avatar .avatar-shape:nth-child(1) {
            animation: morph1 8s ease infinite, pulse-glow 3s ease infinite;
          }
          
          .animate-avatar .avatar-shape:nth-child(2) {
            animation: morph2 12s ease infinite;
          }
          
          .animate-avatar .avatar-shape:nth-child(3) {
            animation: pulse-glow 2s ease infinite;
          }
        `;
        
        // Check if we need to add the styles
        if (!document.getElementById('avatar-animation-styles')) {
          const styleElement = document.createElement('style');
          styleElement.id = 'avatar-animation-styles';
          styleElement.textContent = avatarStyles;
          document.head.appendChild(styleElement);
        }
        
        // AI Avatar functionality
        const exerciseAvatar = document.getElementById('exercise-ai-avatar');
        const exerciseAiMessage = document.getElementById('exercise-ai-message');
        const askExerciseAiBtn = document.getElementById('ask-exercise-ai-btn');
        const exercisePlayAgainBtn = document.getElementById('exercise-play-again-btn');
        const exerciseToggleSoundBtn = document.getElementById('exercise-toggle-sound-btn');
        
        // Only proceed if we found the avatar elements
        if (!exerciseAvatar || !exerciseAiMessage) {
          console.error('Avatar elements not found!');
          return;
        }
        
        let isSpeaking = false;
        let isSoundEnabled = true;
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;
        
        function startAvatarAnimation() {
          exerciseAvatar.classList.add('animate-avatar');
        }
        
        function stopAvatarAnimation() {
          exerciseAvatar.classList.remove('animate-avatar');
        }
        
        function updateSoundButton() {
          const icon = exerciseToggleSoundBtn.querySelector('i');
          if (isSoundEnabled) {
            icon.className = 'fas fa-volume-up';
            exerciseToggleSoundBtn.setAttribute('title', 'Mute');
          } else {
            icon.className = 'fas fa-volume-mute';
            exerciseToggleSoundBtn.setAttribute('title', 'Unmute');
          }
        }
        
        function speakText(text) {
          if (!isSoundEnabled || !speechSynthesis) return;
          
          // Cancel any ongoing speech
          if (isSpeaking) {
            speechSynthesis.cancel();
          }
          
          // Create a new utterance
          const utterance = new SpeechSynthesisUtterance(text);
          currentUtterance = utterance;
          
          // Configure voice settings
          utterance.rate = 1.0;
          utterance.pitch = 1.0;
          
          // Get available voices
          let voices = speechSynthesis.getVoices();
          if (voices.length === 0) {
            // Try getting voices again after a short delay
            setTimeout(() => {
              voices = speechSynthesis.getVoices();
              if (voices.length > 0) {
                setVoice(utterance, voices);
              }
            }, 200);
          } else {
            setVoice(utterance, voices);
          }
          
          // Set speech events
          utterance.onstart = function() {
            isSpeaking = true;
            startAvatarAnimation();
          };
          
          utterance.onend = function() {
            isSpeaking = false;
            stopAvatarAnimation();
            exercisePlayAgainBtn.classList.remove('hidden');
          };
          
          utterance.onerror = function(event) {
            console.error('Speech error:', event.error);
            isSpeaking = false;
            stopAvatarAnimation();
            exercisePlayAgainBtn.classList.remove('hidden');
          };
          
          // Start speaking
          try {
            speechSynthesis.speak(utterance);
          } catch (e) {
            console.error('Speech synthesis error:', e);
            stopAvatarAnimation();
            exercisePlayAgainBtn.classList.remove('hidden');
          }
        }
        
        function setVoice(utterance, voices) {
          // Prefer English voices
          const englishVoices = voices.filter(voice => 
            voice.lang && voice.lang.includes('en') && 
            (voice.name.includes('Natural') || voice.name.includes('Neural') || voice.name.includes('Google'))
          );
          
          if (englishVoices.length > 0) {
            utterance.voice = englishVoices[0];
          }
        }
        
        function getExerciseDetails(dayName) {
          // Clear any previous content
          exerciseAiMessage.textContent = "Analyzing your exercise plan...";
          startAvatarAnimation();
          exercisePlayAgainBtn.classList.add('hidden');
          askExerciseAiBtn.classList.add('hidden');
          
          // If no day provided, get the active day
          if (!dayName) {
            const activeTab = document.querySelector('.day-tab.active-tab');
            if (activeTab) {
              dayName = activeTab.getAttribute('data-day');
            } else {
              // Default to first day
              const firstTab = document.querySelector('.day-tab');
              if (firstTab) {
                dayName = firstTab.getAttribute('data-day');
              } else {
                exerciseAiMessage.textContent = "No exercise plan found.";
                stopAvatarAnimation();
                askExerciseAiBtn.classList.remove('hidden');
                return;
              }
            }
          }
          
          // Get exercise data for the current day
          const dayContent = document.getElementById(`day-${dayName}`);
          if (!dayContent) {
            exerciseAiMessage.textContent = "No exercise plan found for this day.";
            stopAvatarAnimation();
            askExerciseAiBtn.classList.remove('hidden');
            return;
          }
          
          try {
            // Extract exercise information safely
            const dayTitle = dayContent.querySelector('h3')?.textContent || dayName;
            const warmupElement = dayContent.querySelector('h4:nth-of-type(1) + div p');
            const warmup = warmupElement ? warmupElement.textContent : "warm-up routine";
            
            const cooldownElement = dayContent.querySelector('h4:nth-of-type(3) + div p') || 
                                    dayContent.querySelector('h4:last-of-type + div p');
            const cooldown = cooldownElement ? cooldownElement.textContent : "cool down routine";
            
            // Get exercises - limited to first 3 for simplicity
            const exerciseElements = dayContent.querySelectorAll('.bg-gray-700 h5');
            const exercises = Array.from(exerciseElements)
                                   .slice(0, 3)  // Take only first 3 exercises to keep it brief
                                   .map(el => el.textContent)
                                   .join(', ');
            
            const exerciseData = {
              fitness_level: "{{ fitness_level|default:'beginner' }}",
              day_name: dayName,
              day_title: dayTitle,
              warmup: warmup,
              cooldown: cooldown,
              exercises: exercises || "exercises"
            };
            
            // Use the CSRF token from the meta tag
            const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || 
                              '{{ csrf_token }}';
            
            // Fetch AI response about the exercise plan
            fetch('{% url "get_exercise_description" %}', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
              },
              body: JSON.stringify(exerciseData)
            })
            .then(response => {
              if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
              }
              return response.json();
            })
            .then(data => {
              if (data && data.message) {
                exerciseAiMessage.textContent = data.message;
                speakText(data.message);
              } else {
                throw new Error('Invalid response format');
              }
            })
            .catch(error => {
              console.error('Error fetching exercise description:', error);
              // Use a fallback message with the data we extracted
              const fallbackMessage = `Today's ${exerciseData.day_title} workout focuses on key exercises including ${exerciseData.exercises}. Start with a proper ${exerciseData.warmup}, and remember to finish with ${exerciseData.cooldown} to help your muscles recover. Keep your form tight and stay hydrated!`;
              exerciseAiMessage.textContent = fallbackMessage;
              speakText(fallbackMessage);
            })
            .finally(() => {
              exercisePlayAgainBtn.classList.remove('hidden');
            });
          } catch (error) {
            console.error('Error extracting exercise data:', error);
            const errorMessage = `Let's focus on your workout for today. Make sure to warm up properly, maintain good form throughout your exercises, and cool down afterwards.`;
            exerciseAiMessage.textContent = errorMessage;
            speakText(errorMessage);
            exercisePlayAgainBtn.classList.remove('hidden');
            askExerciseAiBtn.classList.remove('hidden');
          }
        }
        
        // Initialize voices for Safari
        if (speechSynthesis) {
          speechSynthesis.onvoiceschanged = function() {
            speechSynthesis.getVoices();
          };
        }
        
        // Toggle sound button
        exerciseToggleSoundBtn.addEventListener('click', function() {
          isSoundEnabled = !isSoundEnabled;
          updateSoundButton();
          
          if (!isSoundEnabled && isSpeaking) {
            speechSynthesis.cancel();
            isSpeaking = false;
            stopAvatarAnimation();
            exercisePlayAgainBtn.classList.remove('hidden');
            askExerciseAiBtn.classList.remove('hidden');
          } else if (isSoundEnabled && !isSpeaking) {
            speakText(exerciseAiMessage.textContent);
          }
        });
        
        // Ask AI button
        askExerciseAiBtn.addEventListener('click', function() {
          getExerciseDetails();
        });
        
        // Play again button
        exercisePlayAgainBtn.addEventListener('click', function() {
          getExerciseDetails();
        });
        
        // Add CSRF meta tag if it doesn't exist
        if (!document.querySelector('meta[name="csrf-token"]')) {
          const metaTag = document.createElement('meta');
          metaTag.setAttribute('name', 'csrf-token');
          metaTag.setAttribute('content', '{{ csrf_token }}');
          document.head.appendChild(metaTag);
        }
        
        // Don't automatically start on page load - wait for Ask AI button
        // Commenting out the existing auto-start code
        /*
        if (document.querySelector('.day-tab')) {
          // Short delay to ensure DOM is fully loaded
          setTimeout(() => {
            // Get current day of week and select that tab if it exists
            const daysOfWeek = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            const today = new Date().getDay(); // 0 = Sunday, 1 = Monday, etc.
            const todayName = daysOfWeek[today];
            
            // Try to find tab for current day
            const todayTab = document.querySelector(`.day-tab[data-day="${todayName}"]`);
            if (todayTab) {
              // Trigger click on today's tab
              todayTab.click();
            } else {
              // Fall back to default behavior (first tab)
              getExerciseDetails();
            }
          }, 500);
        }
        */
      });
    </script>
  </body>
</html> 